@startuml CollegeBuddy Backend - Compact View

!define STRATEGY_COLOR #FFE5CC
!define FACTORY_COLOR #E5CCFF
!define REPOSITORY_COLOR #CCE5FF
!define MVC_COLOR #CCFFCC

title CollegeBuddy Backend - Compact Architecture Overview

skinparam packageStyle rectangle
skinparam linetype ortho

legend right
  |<back:#FFE5CC>   </back>| Strategy Pattern |
  |<back:#E5CCFF>   </back>| Factory Pattern |
  |<back:#CCE5FF>   </back>| Repository Pattern |
  |<back:#CCFFCC>   </back>| MVC Pattern |
  | Chain of Responsibility (Filters) |
endlegend

' ========================================
' PRESENTATION LAYER
' ========================================
package "Presentation Layer (Controllers)" <<MVC_COLOR>> {
  class AuthController {
    +signup()
    +login()
    +verify()
  }

  class ProfileController {
    +getProfile()
    +updateProfile()
    +uploadAvatar()
  }

  class ConnectionController {
    +sendRequest()
    +acceptRequest()
    +getConnections()
  }

  class MessagingController {
    +sendMessage()
    +getConversation()
  }

  class SearchController {
    +search()
  }
}

' ========================================
' FILTER CHAIN
' ========================================
package "Filter Chain" {
  class RequestLoggingFilter
  class RateLimitingFilter
  class JwtAuthFilter {
    -JwtService
  }

  RequestLoggingFilter -down-> RateLimitingFilter : chain
  RateLimitingFilter -down-> JwtAuthFilter : chain
}

' ========================================
' SERVICE LAYER
' ========================================
package "Service Layer (Business Logic)" <<MVC_COLOR>> {
  class AuthService {
    +signup()
    +login()
    +verifyEmail()
  }

  class ProfileService {
    +getProfile()
    +updateProfile()
  }

  class ConnectionService {
    +sendRequest()
    +acceptRequest()
    +getConnections()
  }

  class MessagingService {
    +sendMessage()
    +getConversation()
    +markAsRead()
  }

  class SearchService {
    +search()
  }

  class EmailService {
    -EmailDeliveryStrategy
    +sendVerificationEmail()
    +sendNotificationEmail()
  }

  class MediaStorageService {
    -MediaStorageStrategy
    +storeAvatar()
    +deleteFile()
  }
}

' ========================================
' STRATEGY PATTERN
' ========================================
package "Strategy Pattern" <<STRATEGY_COLOR>> {
  interface EmailDeliveryStrategy <<Strategy>> {
    +send()
    +isAvailable()
  }

  class SmtpEmailDeliveryStrategy
  class LoggingEmailDeliveryStrategy

  interface MediaStorageStrategy <<Strategy>> {
    +store()
    +delete()
    +initialize()
  }

  class LocalFileStorageStrategy

  EmailDeliveryStrategy <|.. SmtpEmailDeliveryStrategy
  EmailDeliveryStrategy <|.. LoggingEmailDeliveryStrategy
  MediaStorageStrategy <|.. LocalFileStorageStrategy
}

' ========================================
' FACTORY PATTERN
' ========================================
package "Factory Pattern" <<FACTORY_COLOR>> {
  class ErrorResponseFactory <<Factory>> {
    +createErrorResponse()
  }

  class UserDtoMapper <<Factory>> {
    +toDto()
    +toDtoList()
  }
}

' ========================================
' REPOSITORY LAYER
' ========================================
package "Repository Layer (Data Access)" <<REPOSITORY_COLOR>> {
  interface JpaRepository<T,ID> <<Spring Data>>

  interface UserRepository
  interface ProfileRepository
  interface ConnectionRepository
  interface MessageRepository
  interface ConversationRepository

  JpaRepository <|-- UserRepository
  JpaRepository <|-- ProfileRepository
  JpaRepository <|-- ConnectionRepository
  JpaRepository <|-- MessageRepository
  JpaRepository <|-- ConversationRepository
}

' ========================================
' DOMAIN LAYER
' ========================================
package "Domain Layer (Entities)" {
  class User {
    id, email, password
    campusDomain, status, role
  }

  class Profile {
    userId, displayName
    bio, avatarUrl, visibility
  }

  class Connection {
    id, userAId, userBId
    createdAt
  }

  class Message {
    id, conversationId
    senderId, body, sentAt
  }

  class Conversation {
    id, userAId, userBId
    createdAt
  }

  User "1" -- "0..1" Profile
  Connection "*" -- "2" User
  Conversation "*" -- "2" User
  Message "*" -- "1" Conversation
}

' ========================================
' MAIN RELATIONSHIPS
' ========================================

' Filter Chain -> Controllers
JwtAuthFilter -down-> AuthController
JwtAuthFilter -down-> ProfileController
JwtAuthFilter -down-> ConnectionController
JwtAuthFilter -down-> MessagingController
JwtAuthFilter -down-> SearchController

' Controllers -> Services
AuthController -down-> AuthService
ProfileController -down-> ProfileService
ConnectionController -down-> ConnectionService
MessagingController -down-> MessagingService
SearchController -down-> SearchService

' Services -> Strategies
EmailService -right-> EmailDeliveryStrategy : uses
MediaStorageService -right-> MediaStorageStrategy : uses

' Services -> Repositories
AuthService -down-> UserRepository
ProfileService -down-> ProfileRepository
ProfileService --> MediaStorageService
ConnectionService -down-> ConnectionRepository
MessagingService -down-> MessageRepository
MessagingService -down-> ConversationRepository

' Repositories -> Domain
UserRepository ..> User : manages
ProfileRepository ..> Profile : manages
ConnectionRepository ..> Connection : manages
MessageRepository ..> Message : manages
ConversationRepository ..> Conversation : manages

' Services use Factories
ProfileService --> UserDtoMapper
ConnectionService --> UserDtoMapper

' Error Handling
class ErrorHandler {
  -ErrorResponseFactory
  +handleException()
}
ErrorHandler --> ErrorResponseFactory

note as N1
  <b>Design Patterns Summary:</b>

  <b>1. Strategy Pattern</b>
  • EmailDeliveryStrategy - Switch email providers
  • MediaStorageStrategy - Switch storage backends

  <b>2. Repository Pattern</b>
  • Clean data access abstraction via Spring Data JPA
  • Separates persistence from business logic

  <b>3. Factory Pattern</b>
  • ErrorResponseFactory - Consistent error creation
  • UserDtoMapper - DTO object creation

  <b>4. MVC Pattern</b>
  • Controllers (presentation)
  • Services (business logic)
  • Repositories (data access)

  <b>5. Chain of Responsibility</b>
  • Filter chain for request processing
  • Logging → Rate Limiting → JWT Auth

  <b>6. Dependency Injection</b>
  • Spring IoC container manages all dependencies
end note

@enduml
